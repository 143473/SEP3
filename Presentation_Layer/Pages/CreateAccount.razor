@page "/CreateAccount"
@using global::Data
@using Presentation_Layer.Authentication
@using Presentation_Layer.Models

@inject IUserService UserService
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider

<h3>Create Account</h3>
<EditForm Model="@user" OnValidSubmit="@CreateAccountAsync">
    <DataAnnotationsValidator/>
    <div class="form-group">
        Name:<br/>
        <InputText @bind-Value="user.Username"/>
        <ValidationMessage For="@(() => user.Username)"/>
    </div>
    <div class="form-group">
        Password:<br/>
        <InputText @bind-Value="user.Password"/>
        <ValidationMessage For="@(() => user.Password)"/>
    </div>
    <div class="form-group">
        Confirm Password:<br/>
        <InputText @bind-Value="user.ConfirmPassword"/>
        <ValidationMessage For="@(() => user.ConfirmPassword)"/>
    </div>

    <p class="actions">
        <button class="btn btn-outline-success" type="submit">Create</button>
    </p>

</EditForm>

@code {
    private readonly User user = new();

    private async Task CreateAccountAsync()
    {
        await UserService.CreateAccountAsync(user);
        await ((CustomAuthenticationStateProvider) AuthenticationStateProvider).ValidateLogin(user.Username, user.Password);
        NavigationManager.NavigateTo("/");
    }
}