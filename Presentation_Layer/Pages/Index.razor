@page "/"
@using global::Data
@using Presentation_Layer.Data
@using Presentation_Layer.Models
@using SEP3_Blazor.Data
@inject NavigationManager NavigationManager
@inject IGameService SoapGame

<h1>BOOK & PLAY - CRUD demo</h1>

<h2 style="color:red;">@title</h2>

Welcome to your new bording games app.
<br/>

    <h3 style="color:green">Add Game</h3>

    <EditForm Model="@Game" OnValidSubmit="@AddGameAsync">
        <DataAnnotationsValidator/>
        <ValidationSummary/>
        <div class="form-group">
            Game part1:
            <InputText type="text" @bind-Value="Game.name"/>
            part 2:
            <InputText type="text" @bind-Value="Game.shortDescription"/>
            <button class="btn btn-outline-dark" type="submit">Create</button>
        </div>
    </EditForm>


@if (GameToEdit != null)
{
    <h3 style="color:green">Edit Game</h3>
    <EditForm Model="@GameToEdit" OnValidSubmit="@Save">
        <DataAnnotationsValidator/>
        <ValidationSummary/>
        <div class="form-group">
            Game part1:
            <InputText @bind-Value="GameToEdit.name"/>
            part 2:
            <InputText @bind-Value="GameToEdit.shortDescription"/>
            <button class="btn btn-outline-dark" type="submit">Edit</button>
        </div>
    </EditForm>
}
else
{
    <h3>Choose a Game to edit</h3>
}

<br/>
<h3>Game List</h3>
@if (GameList == null)
{
    <p>
        <em>Loading...</em>
    </p>
}
else if (!GameList.Any())
{
    <p>
        <em>No Games exist. Please add some.</em>
    </p>
}
else
{
    <table class="table">
        <thead>
        <tr>
            <th>Click to replace title</th>
                <th>id</th>
                <th>name</th>
                <th>complexity</th>
                <th>timeEstimation</th>
                <th>minNumberOfPlayers</th>
                <th>maxNumberOfPlayers</th>
                <th>shorthescription</th>
                <th>neededEquipment</th>
                <th>minAge</th>
                <th>maxAge</th>
                <th>tutorial</th>
            <th>Remove</th>
            <th>Edit</th>

        </tr>
        </thead>
        <tbody>
        @foreach (var item in GameList)
        {
            <tr>
                <td><button @onclick="@(() => ChangeTitle(item.id))">
                                            <i class="oi oi-arrow-top" style="color:red"></i>
                                        </button></td>
                <td>@item.id</td>
                <td>@item.name</td>
                <td>@item.complexity</td>
                <td>@item.timeEstimation</td>
                <td>@item.minNumberOfPlayers</td>
                <td>@item.maxNumberOfPlayers</td>
                <td>@item.shortDescription</td>
                <td>@item.neededEquipment</td>
                <td>@item.minAge</td>
                <td>@item.maxAge</td>
                <td>@item.tutorial</td>
                <td>
                    <button @onclick="@(() => RemoveGameAsync(item.id))">
                        <i class="oi oi-trash" style="color:red"></i>
                    </button>
                </td>
                <td>
                    <button @onclick="@(() => GameToEdit = GameList.FirstOrDefault(t => t.id == item.id))">
                        <i class="oi oi-pencil" style="color:#1b6ec2"></i>
                    </button>
                </td>
            </tr>
        }
        </tbody>
        </table>
}

<Login>Login</Login>

@code
{
    private string title = "Hello World";
    private Game Game = new Game();
    private Game GameToEdit;
    private IList<Game> GameList;

    protected override async Task OnInitializedAsync()
    {
        GameList = await SoapGame.GetGamesAsync();
        GameToEdit = null;
    }
    
    public async Task AddGameAsync()
    {
        await SoapGame.AddGameAsync(Game);
        await OnInitializedAsync();
    }

    public async Task RemoveGameAsync(int id)
    {
        Game GameToRemove = GameList.First(t => t.id == id);
        await SoapGame.RemoveGameAsync(GameToRemove);
        await OnInitializedAsync();
    }

    public async Task ChangeTitle(int id)
    {
        Game GameToTittle = await SoapGame.GetGameAsync(id);
        title = GameToTittle.name;

    }
    
    public async Task Save()
    {
        await SoapGame.UpdateGameAsync(GameToEdit);
        GameToEdit = null;
    }
}
