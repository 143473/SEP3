@page "/GameList"

@using Presentation_Layer.Data
@using Presentation_Layer.Authentication
@using Presentation_Layer.Models
@using System.Security.Claims

@inject IGameListService GameListService
@inject AuthenticationStateProvider StateProvider
@inject NavigationManager NavigationManager

<h3>GameList</h3>
<ul>
@foreach (var game in games)
{
    <li>
        <b @onclick="@(() => MoreGameInfo(game.Id))"><a href="#">@game.Name</a></b>
    </li>
}
</ul>

<button @onclick="@Edit" class="btn btn-outline-secondary" type="submit">
                <i class="oi oi-plus"></i> Edit
        </button>

@code {
    private IList<Game> games = new List<Game>();

    protected override async Task OnInitializedAsync()
    {
        var username = ((CustomAuthenticationStateProvider) StateProvider).GetAuthenticationStateAsync().Result.User.FindFirst(claim => claim.Type.Equals(ClaimTypes.Name))?.Value;
        games = await GameListService.GetUserGamesAsync(username);
    }
    
    private void Edit()
    {
        NavigationManager.NavigateTo("EditGameList");
    }
    
    private void MoreGameInfo(int id)
    {
        NavigationManager.NavigateTo($"GameInfo/{id}");
    }
}